(()=>{"use strict";var t={};(()=>{t.r=t=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(t,"__esModule",{value:true})}})();if(typeof t!=="undefined")t.ab=__dirname+"/";var e={};t.r(e);const i=document.documentElement.clientWidth;const n=document.documentElement.clientHeight;const vw=(t=1)=>i/100*t;const vh=(t=1)=>n/100*t;const vmin=(t=1)=>vw()>vh()?vh(t):vw(t);const vmax=(t=1)=>vw()<vh()?vh(t):vw(t);function ClearCanvas({ctx:t,x:e=0,y:i=0,width:n=clientWidth,height:s=clientHeight}){t===null||t===void 0?void 0:t.fillRect(e,i,n,s)}function FillCanvas({ctx:t,color:e="rgba(0,0,0,0.8)",x:s=0,y:o=0,width:a=i,height:h=n}){if(t===null||t===void 0?void 0:t.fillStyle){t.fillStyle=e}t===null||t===void 0?void 0:t.fillRect(s,o,a,h)}function RenderCanvas(...t){for(const e of t){new Promise((t=>t(e))).catch((t=>{throw new Error(t)}))}requestAnimationFrame((()=>RenderCanvas(...t)))}class AbstractCanvasElement{constructor(t,e){var i,n,s;this.ctx=t;this.x=e.x;this.y=e.y;this.width=e.width;this.height=e.height;this.lineWidth=(i=e.lineWidth)!==null&&i!==void 0?i:0;this.fillStyle=(n=e.fillStyle)!==null&&n!==void 0?n:"grey";this.strokeStyle=(s=e.strokeStyle)!==null&&s!==void 0?s:"rgba(0, 0, 0, 0)"}_Draw(){this.ctx.beginPath();this.ctx.fillStyle=this.fillStyle;this.ctx.fillRect(this.x,this.y,this.width,this.height)}_Update(){}Render(){this._Draw();this._Update()}}class Note extends AbstractCanvasElement{SetPitchOfNote(t){this.height=t}}class AbstractNotes{constructor({ctx:t,notesCount:e,notesStyleProperties:i}){this.ctx=t;this.count=e;this.x=i.x;this.y=i.y;this.width=i.width;this.height=i.height;this.gap=i.gap;this.notes=[];this.noteProperties={x:i.x,y:i.y,width:this.getNoteWidth(),height:0,fillStyle:i.fillStyle};this.createNotes()}getNoteWidth(){const t=(this.width-this.gap*this.count)/this.count;return t}changeNotePositionX(){this.noteProperties.x+=this.noteProperties.width+this.gap}createNotes(){if(!this.ctx){throw new Error("Context is not defined")}for(let t=0;t<this.count;t++){this.notes.push(new Note(this.ctx,this.noteProperties));this.changeNotePositionX()}}}class Notes extends AbstractNotes{constructor({ctx:t,notesCount:e,notesStyleProperties:i}){super({ctx:t,notesCount:e,notesStyleProperties:i})}Play(t){const e=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(e);this.notes.forEach(((t,i)=>{const n=i+i%3;const s=-(e[n]/2);t.SetPitchOfNote(s);t.Render()}))}}class MusicVisualizer{constructor({ctx:t,audioPath:e,particleStyles:i,particlesCount:n=100,animationType:s="notes"}){this.ctx=t;this.animationType=s;const o={ctx:t,notesCount:n,notesStyleProperties:i};this.particles=new Notes(o);this.audio=new Audio(e);this.audioContext=new AudioContext;this.analyser=this.audioContext.createAnalyser();this.source=this.audioContext.createMediaElementSource(this.audio);this.source.connect(this.analyser);this.analyser.connect(this.audioContext.destination);this.animationRequestID=0;document.documentElement.append(this.audio)}_PlayAudio(){if(this.audioContext.state==="suspended"){this.audioContext.resume()}this.audio.play()}_StopAudio(){this.audio.pause()}Play(){this._PlayAudio();this.animationRequestID=requestAnimationFrame((()=>this._Draw()))}Stop(){this._StopAudio();cancelAnimationFrame(this.animationRequestID)}_Draw(){this.particles.Play(this.analyser);this.animationRequestID=requestAnimationFrame((()=>{FillCanvas({ctx:this.ctx});this._Draw()}))}}const s=document.createElement("canvas");const o=s.getContext("2d");const a={x:vw(0),y:vh(100),width:vw(100),height:0,gap:vmin(.1),fillStyle:"white"};const h=300;const c=new MusicVisualizer({ctx:o,animationType:"notes",audioPath:"audio.mp3",particlesCount:h,particleStyles:a});function ResizeCanvas(){s.width=i;s.height=n}function Play(){c.Play()}function Stop(){c.Stop()}function PlayerInit(){ResizeCanvas();const t=document.createElement("button");const e=document.createElement("button");t.textContent="Play";e.textContent="Stop";t.addEventListener("click",Play);e.addEventListener("click",Stop);document.body.append(s,t,e)}window.addEventListener("load",PlayerInit);window.addEventListener("resize",ResizeCanvas);module.exports=e})();
